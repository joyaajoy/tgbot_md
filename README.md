# TODO — GitHub → Telegram Bot (Node.js)

Цель: бот, который берет файлы из GitHub (например README.md), конвертирует в формат, совместимый с Telegram (MarkdownV2 или HTML) и публикует в чате/группе.

## Краткое приоритетное дорожное дерево
- High (обязательно для MVP)
- Medium (важно, но можно позже)
- Low (добавочные улучшения)

---

## High Priority (MVP)
- [ ] Инициализация проекта
  - [ ] package.json, базовая структура (index.js)
  - [ ] .env для переменных окружения (TELEGRAM_TOKEN, GITHUB_TOKEN)
- [ ] Базовый Telegram-бот (polling)
  - [ ] Обработчик /start и /get owner repo [file] [branch]
  - [ ] Ограничение отправки по 4096 символов (разбивка сообщений)
- [ ] Получение файла из GitHub (raw)
  - [ ] Поддержка публичных репозиториев через raw.githubusercontent.com
  - [ ] Поддержка веток (branch/ref)
  - [ ] Поддержка приватных репозиториев через Authorization: token GITHUB_TOKEN
- [ ] Простейшая конвертация Markdown → Telegram (MarkdownV2)
  - [ ] Экранирование спецсимволов Telegram
  - [ ] Заголовки → жирный/курсив
  - [ ] Блоки кода (```), inline-код
  - [ ] Списки, цитаты
  - [ ] Ссылки [text](url) → формат, совместимый с parse_mode
  - [ ] Удаление/обработка картинок (изображения в посте или замена на ссылку)
- [ ] Логирование ошибок и обработка ошибок запросов к GitHub и Telegram
- [ ] Ограничения размера: проверка и разумная усечение/разбиение

---

## Medium Priority
- [ ] Улучшенная конвертация (CommonMark → Telegram HTML)
  - [ ] Использовать парсер (marked/remark) + собственный рендерер для Telegram
  - [ ] Поддержка таблиц (путь: преобразовать в простую моноширинную таблицу или удалить)
- [ ] Поддержка MarkdownV2 и HTML режимов (опция)
- [ ] Обработка изображений
  - [ ] Встраивать изображение как photo (скачивать и отправлять) или отправлять ссылкой
  - [ ] Кэширование изображений
- [ ] Разделение больших файлов на логические части (например, по заголовкам)
- [ ] Команда /preview — показать предварительный просмотр перед публикацией
- [ ] Команда /post — публиковать в указанную группу/канал (с проверкой прав бота)
- [ ] Тесты для конвертера Markdown (unit tests)

---

## Low Priority / Nice-to-have
- [ ] Вебхуки вместо polling (deployment: HTTPS endpoint)
- [ ] Подписка на изменения файла (webhook GitHub или polling с ETag)
- [ ] UI для управления шаблонами постов (шаблон заголовка, подпись)
- [ ] Поддержка нескольких форматов файлов (HTML, .rst)
- [ ] Rate limiting и retry/backoff
- [ ] Dockerfile и инструкция по деплою (Heroku, Vercel, VPS, Docker)
- [ ] CI (GitHub Actions) — lint, тесты
- [ ] Multi-repo конфигурация (через JSON/YAML)
- [ ] Локализация сообщений бота (RU/EN)

---

## Безопасность и конфигурация
- [ ] Хранить токены в .env, не коммитить
- [ ] Ограничить доступ к командам (whitelist chat IDs или админская проверка)
- [ ] Валидация входных параметров (owner, repo, file)
- [ ] Ограничение по размеру скачиваемых файлов (на стороне GitHub fetch)

## Acceptance Criteria для MVP
- [ ] Пользователь выполняет: /get owner repo [file] [branch]
- [ ] Бот скачивает файл (public или private с токеном)
- [ ] Бот конвертирует Markdown в корректный текст для Telegram (без сломанных форматирований)
- [ ] Бот отправляет текст, не превышая лимитов Telegram, в тот же чат
- [ ] Логи ошибок при неудачах

## Примерная оценка времени (ориентировочно)
- Инициализация + базовый /get + fetch raw: 1–2 часа
- Базовый конвертер и экранирование: 2–4 часа
- Разбивка сообщений и обработка ошибок: 1–2 часа
- Тесты + docs: 2–4 часа

## Файлы/шаблоны для создания
- index.js — основной бот
- lib/github.js — fetcher GitHub (raw + token support)
- lib/convert.js — Markdown → Telegram converter (unit-tested)
- .env.example
- TODO.md (этот файл)
- README.md — установка и запуск
- Dockerfile (опционально)
- .github/workflows/ci.yml (CI)

---

## Замечания
- Для корректной работы с Telegram-символами рекомендую целенаправленно использовать MarkdownV2 или HTML; MarkdownV2 требует тщательного экранирования.
- Для сложных Markdown-структур предпочтительнее парсить Markdown в AST (remark/markdown-it) и рендерить под Telegram вручную — это дороже по времени, но надежнее.
